FROM vllm/vllm-openai:v0.10.1

# Установка дополнительных зависимостей
RUN pip install --no-cache-dir \
    pynvml \
    psutil \
    structlog \
    prometheus-client

# Создание пользователя vllm
RUN groupadd -r vllm && useradd -r -g vllm -m vllm

# Создание рабочих директорий и установка прав
RUN mkdir -p /workspace /app/logs && \
    chown -R vllm:vllm /workspace /app/logs /home/vllm

# Рабочая директория
WORKDIR /workspace

# Пользователь vllm
USER vllm

# Порты
EXPOSE 8000 8001

# Запуск стандартного OpenAI-совместимого сервера vLLM
ENTRYPOINT ["python", "-m", "vllm.entrypoints.openai.api_server"]
CMD ["--host", "0.0.0.0", "--port", "8000"]
