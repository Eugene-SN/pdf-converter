[2025-10-16T13:22:20.538+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: quality_assurance.load_translated_document manual__2025-10-16T13:22:18.547753+00:00 [queued]>
[2025-10-16T13:22:20.543+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: quality_assurance.load_translated_document manual__2025-10-16T13:22:18.547753+00:00 [queued]>
[2025-10-16T13:22:20.543+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 2
[2025-10-16T13:22:20.551+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): load_translated_document> on 2025-10-16 13:22:18.547753+00:00
[2025-10-16T13:22:20.558+0000] {standard_task_runner.py:60} INFO - Started process 238 to run task
[2025-10-16T13:22:20.561+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'quality_assurance', 'load_translated_document', 'manual__2025-10-16T13:22:18.547753+00:00', '--job-id', '1669', '--raw', '--subdir', 'DAGS_FOLDER/quality_assurance.py', '--cfg-path', '/tmp/tmpo6_qbgho']
[2025-10-16T13:22:20.563+0000] {standard_task_runner.py:88} INFO - Job 1669: Subtask load_translated_document
[2025-10-16T13:22:20.608+0000] {task_command.py:423} INFO - Running <TaskInstance: quality_assurance.load_translated_document manual__2025-10-16T13:22:18.547753+00:00 [running]> on host 9615e0ed13ab
[2025-10-16T13:22:20.679+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='pdf-converter' AIRFLOW_CTX_DAG_ID='quality_assurance' AIRFLOW_CTX_TASK_ID='load_translated_document' AIRFLOW_CTX_EXECUTION_DATE='2025-10-16T13:22:18.547753+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-10-16T13:22:18.547753+00:00'
[2025-10-16T13:22:20.682+0000] {quality_assurance.py:463} INFO - 🔍 Начало полной 5-уровневой QA валидации
[2025-10-16T13:22:20.682+0000] {shared_utils.py:213} INFO - 📊 Метрики: {'dag_id': 'quality_assurance', 'task_id': 'load_translated_document', 'processing_time_seconds': 0.00043773651123046875, 'pages_processed': 0, 'file_size_mb': 0.0, 'success': True, 'timestamp': '2025-10-16T13:22:20.682749'}
[2025-10-16T13:22:20.682+0000] {quality_assurance.py:504} INFO - ✅ Документ загружен для полной QA: 10238 символов
[2025-10-16T13:22:20.683+0000] {python.py:201} INFO - Done. Returned value was: {'session_id': 'qa_full_1760620940', 'translated_file': '/app/output/zh/1760620807_test_short.md', 'translated_content': '# 命令列表\n\n| 命令名称 | NetFn | CMD | 权限级别 | 备注 |\n|---------|------|-----|----------|------|\n| `chassis status` | - | - | User | 获取当前服务器 (Server) 状态 |\n| `chassis restart_cause` | - | - | User | 获取服务器 (Server) 系统上次重启原因 |\n| `chassis selftest` | - | - | User | 获取服务器 (Server) 系统自检结果 |\n| `chassis policy always-on/previous/always-off` | - | - | Operator | 设置服务器 (Server) 系统电源 (Power Supply) 恢复策略为：自动开机 / 恢复至断电前状态 / 保持关机状态 |\n| `chassis bootdev {device}` | - | - | Operator | 设置服务器 (Server) 的启动设备 |\n| `power status` | - | - | User | 获取服务器 (Server) 系统电源 (Power Supply) 当前状态 |\n| `power on/up` | - | - | Operator | 设置服务器 (Server) 开机 |\n| `power off/down` | - | - | Operator | 设置服务器 (Server) 关机 |\n| `power reset` | - | - | Operator | 设置服务器 (Server) 重启 |\n| `mc info` | - | - | User | 获取服务器 (Server) 管理系统各模块信息 |\n| `mc selftest` | - | - | User | 获取服务器 (Server) 管理系统自检结果 |\n| `mc reset cold` | - | - | Admin | 设置服务器 (Server) 管理系统冷重启 |\n| `sdr` | - | - | User | 获取服务器 (Server) 所有传感器的部分信息 |\n| `sensor list` | - | - | User | 获取服务器 (Server) 所有传感器的详细参数信息 |\n| `sensor get {sensor-name}` | - | - | User | 获取服务器 (Server) 指定传感器的详细信息 |\n| `sensor thresh {sensor-name}` | - | - | Admin | 设置服务器 (Server) 指定传感器的阈值 |\n| `sel` | - | - | User | 获取系统事件日志 (SEL) 信息 |\n| `sel elist` | - | - | User | 获取系统详细日志记录 |\n| `fru` | - | - | User | 获取现场可替换单元 (FRU) 信息 |\n| `session info active` | - | - | User | 获取服务器 (Server) 管理系统当前活跃用户的会话信息 |\n| `user list` | - | - | User | 获取所有用户信息 |\n| `user set name {User id} {Username}` | - | - | Admin | 设置服务器 (Server) 管理系统新增用户名 |\n| `user set password {User id} {password}` | - | - | Admin | 设置服务器 (Server) 管理系统指定用户的密码 |\n| `user test {User id} {16|20} {password}` | - | - | Admin | 验证用户名与密码的正确性 |\n| `user disable {User id}` | - | - | Admin | 禁用指定用户的服务器 (Server) 管理系统访问权限 |\n| `user enable {User id}` | - | - | Admin | 启用指定用户的服务器 (Server) 管理系统访问权限 |\n| `user priv {User id} {privilege level}` | - | - | Admin | 设置指定用户的服务器 (Server) 管理系统访问权限 |\n\n> **说明：**  \n> - 所有命令均适用于 **联想问天 (Lenovo WenTian)** 系列服务器，兼容 **天擎 (ThinkSystem)** 平台。  \n> - 支持 **英特尔 (Intel)** 至强 (Xeon) 处理器平台，适用于企业级数据中心部署。  \n> - 权限级别定义：  \n>   - `User`：普通用户权限，可执行只读操作。  \n>   - `Operator`：操作员权限，可执行设备控制类操作。  \n>   - `Admin`：管理员权限，可执行系统配置与安全策略变更。\n\n# 服务器 (Server) 管理系统用户与电源策略配置\n\n## 用户管理命令\n\n| 命令 | 参数说明 | 权限级别 | 操作角色 | 功能描述 |\n|------|----------|----------|----------|----------|\n| `User set name {User id} {Username}` | 设置用户ID及用户名 | Admin | 管理员 | 在服务器 (Server)管理系统中新增指定用户名 |\n| `User set password {User id} {password}` | 设置用户ID及对应密码 | Admin | 管理员 | 为服务器 (Server)管理系统指定用户设置密码 |\n| `User test {User id} {16 | 20} {password}` | 验证用户ID及密码有效性 | Admin | 管理员 | 验证指定用户的用户名与密码是否正确 |\n| `User disable {User id}` | 禁用指定用户ID | Admin | 管理员 | 关闭指定用户的服务器 (Server)管理系统访问权限 |\n| `User enable {User id}` | 启用指定用户ID | Admin | 管理员 | 开启指定用户的服务器 (Server)管理系统访问权限 |\n| `User priv {User id} {privilege level}` | 设置用户权限级别 | Admin | 管理员 | 配置指定用户在服务器 (Server)管理系统中的访问权限等级 |\n\n---\n\n## `chassis selftest`（获取服务器 (Server)系统自检结果）\n\n| 项目 | 说明 |\n|------|------|\n| **命令描述** | `chassis selftest` 命令用于获取服务器 (Server)系统的硬件自检（Self-Test）结果，用于诊断系统启动前的硬件状态 |\n| **权限级别** | user |\n| **命令示例** | ```bash<br>lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus chassis selftest<br>Self Test Results : passed<br>``` |\n\n> **说明**：  \n> - `BMC_IP`：服务器 (Server)管理控制器（BMC）的IP地址  \n> - `USERID`：具有访问权限的用户名  \n> - `PASSW0RD`：对应用户的密码（注意：此处为示例，实际使用需替换为真实密码）  \n> - `lanplus`：IPMI over LAN 协议类型  \n> - 返回结果为 `passed` 表示自检通过，`failed` 表示存在硬件故障\n\n---\n\n## `chassis policy always-on/previous/always-off`（设置服务器 (Server)系统电源 (Power Supply)恢复策略）\n\n| 项目 | 说明 |\n|------|------|\n| **命令描述** | `chassis policy` 命令用于设置服务器 (Server)系统在电源恢复后的自动开机策略。支持以下三种模式：<br>1. **always-on**：电源接通后，系统自动启动<br>2. **previous**：电源恢复后，系统恢复至断电前的运行状态（如开机/关机）<br>3. **always-off**：电源接通后，系统保持关机状态 |\n| **权限级别** | operator |\n| **命令示例** | ```bash<br>-H [BMC_IP] -U USERID -P PASSW0RD -I lanplus<br>lenovo:~# ipmitool chassis policy state <state><br>```<br><br>**参数说明**：<br>- `<state>`：可选值为 `always-on`、`previous` 或 `always-off`<br>- `list`：查询当前支持的电源恢复策略列表 |\n\n> **使用建议**：<br>在数据中心高可用场景中，推荐使用 `previous` 策略以保障业务连续性；在安全要求较高的环境中，建议使用 `always-off` 以防止未经授权的自动启动。\n\n -U USERID -P PASSW0RD -I lanplus chassis policy state list` |\n\n> **说明**：`list` 参数用于查询当前支持的电源恢复策略。\n\n---\n\n## 启动设备设置（chassis bootdev）\n\n`chassis bootdev` 命令用于设置服务器（Server）系统的**一次性启动设备**（One-time Boot Device），适用于临时更改启动顺序，无需修改永久启动配置。\n\n| **权限级别** | `operator` |\n|--------------|------------|\n| **命令格式** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus chassis bootdev <device> [options]` |\n\n> **支持的启动设备类型**：`pxe`, `disk`, `cdrom`, `bios`, `uefi`, `network`, `usb`, `safe-mode`, `recovery`\n\n---\n\n## SOL 功能激活（sol activate）\n\n`sol activate` 命令用于激活 **串行过 LAN（Serial Over LAN, SOL）** 功能，实现通过网络远程访问服务器（Server）的串行控制台。\n\n| **权限级别** | `administrator` |\n|--------------|-----------------|\n| **命令示例** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate`<br>`ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate usesolkeepalive` |\n\n> **输出提示**：`[SOL Session operational. Use ~? for help]`  \n> **使用说明**：激活后可通过 `~?` 查看 SOL 会话操作帮助。\n\n---\n\n## SOL 功能关闭（sol deactivate）\n\n`sol deactivate` 命令用于关闭当前激活的 **SOL 会话**，释放远程控制台连接。\n\n| **权限级别** | `administrator` |\n|--------------|-----------------|\n| **命令示例** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol deactivate` |\n\n---\n\n## Lenovo BMC 支持的 OEM RAW 命令\n\n以下为 Lenovo BMC 支持的 OEM（专有）RAW 命令，用于扩展硬件管理功能，适用于 **问天 (WenTian)**、**联想问天 (Lenovo WenTian)**、**天擎 (ThinkSystem)** 系列服务器，支持 **至强 (Xeon)**、**英特尔 (Intel)** 平台。\n\n> **使用说明**：OEM RAW 命令需通过 `ipmitool raw` 调用，具体命令格式为：<br>`ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus raw 0x30 0x01 [data...]`\n\n> **注意**：请参考《Lenovo BMC OEM Command Reference》获取完整命令列表与参数说明。\n\n# SOL（Serial Over LAN）功能操作\n\n## sol activate（激活 SOL 功能）\n\n| 项目 | 说明 |\n|------|------|\n| 命令描述 | `sol activate` 命令用于激活 SOL（Serial Over LAN）功能 |\n| 权限要求 | administrator |\n| 命令示例 | ```bash<br>lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate usesolkeepalive<br>[SOL Session operational. Use ~? for help]<br>``` |\n\n## sol deactivate（关闭 SOL 功能）\n\n| 项目 | 说明 |\n|------|------|\n| 命令描述 | `sol deactivate` 命令用于关闭 SOL（Serial Over LAN）功能 |\n| 权限要求 | administrator |\n| 命令示例 | ```bash<br>lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol deactivate<br>``` |\n\n---\n\n## Lenovo BMC 支持的 OEM RAW 命令\n\n### Get SNMP Trap Info（获取 SNMP Trap 信息）\n\n| 命令 | `netfn=0x30`, `cmd=0x02` |\n|------|--------------------------|\n\n#### 请求数据（Request Data）\n\n| 字节 | 数据字段 |\n|------|----------|\n| 1 | 用户 ID，取值范围：01h 至 05h |\n| 2 | 参数类型：<br>01h - enable<br>02h - severity<br>03h - version<br>04h - mode<br>05h - community<br>06h - user<br>07h - user encrypt<br>08h - password<br>09h - pass encrypt<br>0Ah - destination IP<br>0Bh - port<br>0Ch - LAN 通道<br>0Dh - enter ID |\n\n#### 响应数据（Response Data）\n\n| 参数 | 字节 | 数据字段 |\n|------|------|----------|\n| 01h (enable) | 1 | 完成码<br>2 | 00h - disable<br>&nbsp;&nbsp;&nbsp;&nbsp;01h - enable |\n| 02h (severity) | 1 | 完成码<br>2 | 01h - critical<br>&nbsp;&nbsp;&nbsp;&nbsp;02h - critical and warning<br>&nbsp;&nbsp;&nbsp;&nbsp;03h - all |\n| 03h (version) | 1 | 完成码<br>2 | 01h - v1<br>&nbsp;&nbsp;&nbsp;&nbsp;02h - v2c<br>&nbsp;&nbsp;&nbsp;&nbsp;03h - v3 |\n| 04h (mode) | 1 | 完成码<br>2 | 模式值（具体含义依配置而定） |\n| 05h (community) | 1 | 完成码<br>2:17 | community 字符串 |\n| 06h (user) | 1 | 完成码<br>2:17 | 用户名字符串 |\n| 07h (user encrypt) | 1 | 完成码<br>2 | 00h - 用户加密<br>&nbsp;&nbsp;&nbsp;&nbsp;01h - 用户非加密 |\n| 08h (password) | 1 | 完成码<br>2:17 | 密码字符串 |\n| 09h (pass encrypt) | 1 | 完成码<br>2 | 00h - 密码加密<br>&nbsp;&nbsp;&nbsp;&nbsp;01h - 密码非加密 |\n| 0Ah (destination IP) | 1 | 完成码<br>2:33 | 目标 IP 地址 |\n| 0Bh (port) | 1 | 完成码<br>2:3 | 端口号 |\n| 0Ch (LAN channel) | 1 | 完成码<br>2 | LAN 通道编号 |\n| 0Dh (enter ID) | 1 | 完成码<br>2:33 | Enter ID 值 |\n\n#### 命令示例\n\n```bash\n# ipmitool -H 10.109.107.160 -U USERID -P PASSW0RD raw 0x30 0x02 01h\n# ipmitool -H 10.109.107.160 -U USERID -P PASSW0RD raw 0x30 0x02 05h\n# ipmitool -H 10.109.107.160 -U USERID -P PASSW0RD raw 0x30 0x02 0Dh\n```\n\n```markdown\n### 设置 SNMP Trap 信息（Set SNMP Trap Info）\n\n| 命令 | `netfn=0x30`, `cmd=0x03` |\n|------|--------------------------|\n\n#### 请求数据（Request Data）\n\n| 字节 (Byte) | 数据字段 (Data Field) |\n|-------------|------------------------|\n| 1           | 用户 ID（取值范围：01h 至 05h） |\n| 2           | 参数标识（Parameter ID）：<br>• 01h：启用状态<br>• 02h：严重级别<br>• 03h：版本<br>• 04h：模式<br>• 05h：团体名（Community）<br>• 06h：用户名<br>• 07h：用户加密状态<br>• 08h：密码<br>• 09h：密码加密状态<br>• 0Ah：目标 IP 地址<br>• 0Bh：端口<br>• 0Ch：LAN 通道<br>• 0Dh：进入 ID |\n\n#### 参数值说明（Parameter Values）\n\n| 参数 ID (Parameter ID) | 可选值 (Valid Values) | 说明 |\n|------------------------|------------------------|------|\n| 01h（启用状态）        | 00h：禁用<br>01h：启用 | 控制 SNMP Trap 功能的启用或禁用 |\n| 02h（严重级别）        | 01h：严重（Critical）<br>02h：严重和警告（Critical & Warning）<br>03h：全部（All） | 设置触发 SNMP Trap 的事件严重等级 |\n| 03h（版本）            | 01h：SNMPv1<br>02h：SNMPv2c<br>03h：SNMPv3 | 指定 SNMP 协议版本 |\n| 04h（模式）            | 01h：无认证<br>02h：认证<br>03h：加密 | 定义 SNMP 通信的安全模式 |\n| 05h（团体名）          | 字符串（最大 32 字节） | SNMPv1/v2c 使用的团体名 |\n| 06h（用户名）          | 字符串（最大 32 字节） | SNMPv3 用户名 |\n| 07h（用户加密状态）    | 00h：不加密<br>01h：加密 | 是否对用户信息进行加密 |\n| 08h（密码）            | 字符串（最大 32 字节） | 用户密码 |\n| 09h（密码加密状态）    | 00h：不加密<br>01h：加密 | 是否对密码进行加密 |\n| 0Ah（目标 IP 地址）    | 4 字节 IPv4 地址（如：10.109.107.160） | 接收 SNMP Trap 的目标主机 IP |\n| 0Bh（端口）            | 2 字节端口号（如：162） | SNMP Trap 接收端口 |\n| 0Ch（LAN 通道）        | 1 字节通道号（如：1） | 指定使用的 LAN 通道 |\n| 0Dh（进入 ID）         | 1 字节 ID（如：1） | 用于标识配置上下文的进入 ID |\n\n#### 响应数据（Response Data）\n\n| 字节 (Byte) | 数据字段 (Data Field) |\n|-------------|------------------------|\n| 1           | 完成代码（Completion Code） |\n\n#### 命令示例（Command Example）\n\n```bash\n# ipmitool -H `10.109.107.160` -U USERID -P PASSW0RD raw 0x30 0x03 0x01 0x01 0x02 0x03 0x01 0x01 0x02 0x01 0x03 0x02 0x04 0x02 0x05 0x73 0x6E 0x6D 0x70 0x5F 0x63 0x6F 0x6D 0x6D 0x75 0x6E 0x69 0x74 0x79 0x06 0x75 0x73 0x65 0x72 0x31 0x07 0x01 0x08 0x50 0x41 0x53 0x53 0x57 0x4F 0x52 0x44 0x09 0x01 0x0A 0x0A 0x6D 0x69 0x6E 0x65 0x0B 0x01 0x0C 0x01 0x0D 0x01\n```\n\n> **说明**：  \n> - 本命令适用于 **联想问天 (Lenovo WenTian)** 系列服务器，支持 **天擎 (ThinkSystem)** 平台的 IPMI 2.0 接口。  \n> - 所有参数均需按字节顺序发送，且需确保目标设备已启用 IPMI 功能。  \n> - 建议使用 **至强 (Xeon)** 处理器平台的服务器进行配置验证。  \n> - 请将 `10.109.107.160`、`USERID`、`PASSW0RD` 替换为实际的管理 IP 地址和凭证。  \n> - 本操作需在 **英特尔 (Intel)** 平台硬件上执行，确保兼容性。\n```', 'original_config': {'chinese_document': True, 'container_temp_dir': '/opt/***/temp', 'enable_ocr': True, 'extract_images': True, 'extract_tables': True, 'filename': 'test_short.pdf', 'input_dir': '/app/input', 'input_file': '/app/input/test_short.pdf', 'master_run_id': 'manual__2025-10-16T13:20:07.952314+00:00', 'output_target_dir': '/app/output/en', 'output_zh_dir': '/app/output/zh', 'pipeline_version': '4.0_fixed', 'preserve_structure': True, 'preserve_technical_terms': True, 'processing_stages': 4, 'processing_start_time': '2025-10-16T13:20:09.774904', 'qa_fail_action': 'halt', 'quality_level': 'high', 'quality_target': 95.0, 'stage_mode': 'full_with_translation', 'target_language': 'en', 'timestamp': 1760620807, 'translation_required': True, 'validation_enabled': True}, 'translation_metadata': {}, 'qa_start_time': '2025-10-16T13:22:20.682722', 'target_quality': 95.0, 'auto_correction': True, 'original_pdf_path': '/app/input/test_short.pdf', 'document_id': '1760620807_test_short', 'enable_5_level_validation': True, 'enterprise_mode': True, 'level_configs': {'level1_ocr': {'consensus_threshold': 0.85, 'similarity_threshold': 0.8, 'engines': ['paddleocr', 'tesseract']}, 'level2_visual': {'ssim_threshold': 0.95, 'difference_tolerance': 0.1, 'page_comparison_mode': 'structural', 'pandoc_integration': True}, 'level3_ast': {'structural_similarity_threshold': 0.9, 'semantic_similarity_threshold': 0.85, 'model_name': 'sentence-transformers/all-MiniLM-L6-v2'}, 'level4_content': {'min_technical_terms': 5, 'min_code_blocks': 1, 'formatting_score_threshold': 0.8}, 'level5_correction': {'vllm_endpoint': 'http://vllm-server:8000/v1/chat/completions', 'correction_model': 'Qwen/Qwen3-30B-A3B-Instruct-2507', 'max_retries': 5, 'enable_auto_correction': True}}, 'qa_rules': {'min_content_length': 100, 'min_headings': 1, 'max_chinese_chars_ratio': 0.2, 'require_title': True, 'check_table_structure': True, 'validate_markdown_syntax': True, 'technical_terms_check': True, 'preserve_brand_names': True, 'min_quality_score': 80.0, 'excellent_quality_score': 95.0, 'OCR_CONFIDENCE_THRESHOLD': 0.8, 'VISUAL_SIMILARITY_THRESHOLD': 0.95, 'AST_SIMILARITY_THRESHOLD': 0.9, 'SEMANTIC_SIMILARITY_THRESHOLD': 0.85, 'OVERALL_QA_THRESHOLD': 0.85, 'MAX_CORRECTIONS_PER_DOCUMENT': 10, 'AUTO_CORRECTION_CONFIDENCE': 0.7}}
[2025-10-16T13:22:20.706+0000] {taskinstance.py:1138} INFO - Marking task as SUCCESS. dag_id=quality_assurance, task_id=load_translated_document, execution_date=20251016T132218, start_date=20251016T132220, end_date=20251016T132220
[2025-10-16T13:22:20.732+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 0
[2025-10-16T13:22:20.758+0000] {taskinstance.py:3280} INFO - 3 downstream tasks scheduled from follow-on schedule check
