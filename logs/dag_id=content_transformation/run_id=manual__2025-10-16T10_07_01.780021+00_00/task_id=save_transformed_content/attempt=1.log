[2025-10-16T10:07:40.923+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: content_transformation.save_transformed_content manual__2025-10-16T10:07:01.780021+00:00 [queued]>
[2025-10-16T10:07:40.929+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: content_transformation.save_transformed_content manual__2025-10-16T10:07:01.780021+00:00 [queued]>
[2025-10-16T10:07:40.929+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 3
[2025-10-16T10:07:40.938+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): save_transformed_content> on 2025-10-16 10:07:01.780021+00:00
[2025-10-16T10:07:40.943+0000] {standard_task_runner.py:60} INFO - Started process 731 to run task
[2025-10-16T10:07:40.945+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'content_transformation', 'save_transformed_content', 'manual__2025-10-16T10:07:01.780021+00:00', '--job-id', '1631', '--raw', '--subdir', 'DAGS_FOLDER/content_transformation.py', '--cfg-path', '/tmp/tmp8atth6iz']
[2025-10-16T10:07:40.946+0000] {standard_task_runner.py:88} INFO - Job 1631: Subtask save_transformed_content
[2025-10-16T10:07:40.990+0000] {task_command.py:423} INFO - Running <TaskInstance: content_transformation.save_transformed_content manual__2025-10-16T10:07:01.780021+00:00 [running]> on host b43a95b9d13d
[2025-10-16T10:07:41.057+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='pdf-converter' AIRFLOW_CTX_DAG_ID='content_transformation' AIRFLOW_CTX_TASK_ID='save_transformed_content' AIRFLOW_CTX_EXECUTION_DATE='2025-10-16T10:07:01.780021+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-10-16T10:07:01.780021+00:00'
[2025-10-16T10:07:41.082+0000] {shared_utils.py:213} INFO - 📊 Метрики: {'dag_id': 'content_transformation', 'task_id': 'save_transformed_content', 'processing_time_seconds': 0.024433374404907227, 'pages_processed': 0, 'file_size_mb': 0.0, 'success': True, 'timestamp': '2025-10-16T10:07:41.082622'}
[2025-10-16T10:07:41.082+0000] {content_transformation.py:1523} INFO - 💾 Полностью трансформированный контент сохранен: /app/output/zh/1760609154_test_short.md
[2025-10-16T10:07:41.083+0000] {python.py:201} INFO - Done. Returned value was: {'markdown_file': '/app/output/zh/1760609154_test_short.md', 'markdown_content': '# 命令列表\n\n| 命令名称 | NetFn | CMD | 权限级别 | 备注 |\n|---------|------|-----|----------|------|\n| `chassis status` | - | - | User | 获取当前服务器 (Server) 状态 |\n| `chassis restart_cause` | - | - | User | 获取服务器 (Server) 系统上次重启原因 |\n| `chassis selftest` | - | - | User | 获取服务器 (Server) 系统自检结果 |\n| `chassis policy always-on/previous/always-off` | - | - | Operator | 设置服务器 (Server) 系统电源 (Power Supply) 恢复策略：<br>• `always-on`：自动开机<br>• `previous`：恢复到断电前状态<br>• `always-off`：保持关机状态 |\n| `chassis bootdev {device}` | - | - | Operator | 设置服务器 (Server) 的启动设备 |\n| `power status` | - | - | User | 获取服务器 (Server) 系统电源 (Power Supply) 当前状态 |\n| `power on/up` | - | - | Operator | 设置服务器 (Server) 开机 |\n| `power off/down` | - | - | Operator | 设置服务器 (Server) 关机 |\n| `power reset` | - | - | Operator | 设置服务器 (Server) 重启 |\n| `mc info` | - | - | User | 获取服务器 (Server) 管理系统各模块信息 |\n| `mc selftest` | - | - | User | 获取服务器 (Server) 管理系统自检结果 |\n| `mc reset cold` | - | - | Admin | 设置服务器 (Server) 管理系统冷重启 |\n| `sdr` | - | - | User | 获取服务器 (Server) 所有传感器的部分信息 |\n| `sensor list` | - | - | User | 获取服务器 (Server) 所有传感器的详细参数信息 |\n| `sensor get {sensor-name}` | - | - | User | 获取服务器 (Server) 指定传感器的详细信息 |\n| `sensor thresh {sensor-name}` | - | - | Admin | 设置服务器 (Server) 指定传感器的阈值 |\n| `sel` | - | - | User | 获取系统事件日志 (SEL) 信息 |\n| `sel elist` | - | - | User | 获取系统详细日志记录 |\n| `fru` | - | - | User | 获取现场可替换单元 (FRU) 信息 |\n| `session info active` | - | - | User | 获取服务器 (Server) 管理系统当前活跃用户的会话信息 |\n| `user list` | - | - | User | 获取所有用户信息 |\n| `user set name {User id} {Username}` | - | - | Admin | 设置服务器 (Server) 管理系统新增用户名 |\n| `user set password {User id} {password}` | - | - | Admin | 设置服务器 (Server) 管理系统指定用户的密码 |\n| `user test {User id} {16|20} {password}` | - | - | Admin | 验证用户名与密码的正确性（支持16位或20位密码） |\n| `user disable {User id}` | - | - | Admin | 禁用指定用户的服务器 (Server) 管理系统访问权限 |\n| `user enable {User id}` | - | - | Admin | 启用指定用户的服务器 (Server) 管理系统访问权限 |\n| `user priv {User id} {privilege level}` | - | - | Admin | 设置指定用户的服务器 (Server) 管理系统访问权限等级 |\n\n> **说明**：\n> - 所有命令均适用于 **联想问天 (Lenovo WenTian)** 系列服务器，兼容 **天擎 (ThinkSystem)** 平台。\n> - 支持 **英特尔 (Intel)** 至强 (Xeon) 处理器平台。\n> - 权限级别定义：\n>   - `User`：普通用户权限\n>   - `Operator`：操作员权限\n>   - `Admin`：管理员权限\n\n# 服务器 (Server) 管理系统用户与电源策略配置\n\n## 用户管理命令\n\n| 命令 | 参数说明 | 权限级别 | 操作角色 | 功能描述 |\n|------|----------|----------|----------|----------|\n| `User set name {User id} {Username}` | 设置用户ID及用户名 | Admin | 管理员 | 在服务器 (Server)管理系统中新增指定用户名 |\n| `User set password {User id} {password}` | 设置用户ID及对应密码 | Admin | 管理员 | 为服务器 (Server)管理系统指定用户设置密码 |\n| `User test {User id} {16 | 20} {password}` | 验证用户ID及密码有效性 | Admin | 管理员 | 验证指定用户的用户名与密码是否正确 |\n| `User disable {User id}` | 禁用指定用户ID | Admin | 管理员 | 关闭指定用户的服务器 (Server)管理系统访问权限 |\n| `User enable {User id}` | 启用指定用户ID | Admin | 管理员 | 开启指定用户的服务器 (Server)管理系统访问权限 |\n| `User priv {User id} {privilege level}` | 设置用户权限级别 | Admin | 管理员 | 配置指定用户在服务器 (Server)管理系统中的访问权限等级 |\n\n---\n\n## `chassis selftest`（获取服务器 (Server)系统自检结果）\n\n| 项目 | 说明 |\n|------|------|\n| **命令描述** | `chassis selftest` 命令用于获取服务器 (Server)系统的硬件自检（Self-Test）结果，用于诊断系统启动前的硬件状态 |\n| **权限级别** | user |\n| **命令示例** | ```bash<br>lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus chassis selftest<br>Self Test Results : passed<br>``` |\n\n> **说明**：  \n> - `BMC_IP`：服务器 (Server)管理控制器（BMC）的IP地址  \n> - `USERID`：具有访问权限的用户名  \n> - `PASSW0RD`：对应用户的密码（注意：此处为示例，实际使用需替换为真实密码）  \n> - `lanplus`：IPMI over LAN 协议类型  \n> - 返回结果为 `passed` 表示自检通过，`failed` 表示存在硬件故障\n\n---\n\n## `chassis policy always-on/previous/always-off`（设置服务器 (Server)系统电源 (Power Supply)恢复策略）\n\n| 项目 | 说明 |\n|------|------|\n| **命令描述** | `chassis policy` 命令用于设置服务器 (Server)系统在电源恢复后的自动开机策略。支持以下三种模式：<br>1. **always-on**：电源接通后，系统自动启动<br>2. **previous**：电源恢复后，系统恢复至断电前的运行状态（如开机/关机）<br>3. **always-off**：电源接通后，系统保持关机状态 |\n| **权限级别** | operator |\n| **命令示例** | ```bash<br>-H [BMC_IP] -U USERID -P PASSW0RD -I lanplus<br>lenovo:~# ipmitool chassis policy state <state><br>```<br><br>**参数说明**：<br>- `<state>`：可选值为 `always-on`、`previous` 或 `always-off`<br>- `list`：查询当前支持的电源恢复策略列表 |\n\n> **使用建议**：<br>在数据中心高可用场景中，推荐使用 `previous` 策略以保障业务连续性；在安全要求较高的环境中，建议使用 `always-off` 以防止未经授权的自动启动。\n\nUSERID -P PASSW0RD -I lanplus chassis policy state list` |\n\n> **说明**：`list` 参数用于返回当前支持的电源恢复策略列表。\n\n---\n\n## 启动设备设置（chassis bootdev）\n\n`chassis bootdev` 命令用于设置服务器（Server）系统的**一次性启动项**（One-time Boot Device），适用于临时更改启动顺序，完成启动后恢复默认设置。\n\n| **权限级别** | operator |\n|--------------|----------|\n| **命令示例** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus chassis bootdev [device] options`<br>其中 `[device]` 可选值包括：`pxe`, `disk`, `cdrom`, `bios`, `uefi-shell`, `network`, `usb` 等 |\n\n> **注意**：该命令适用于联想问天（Lenovo WenTian）系列服务器及天擎（ThinkSystem）系列服务器，支持至强（Xeon）处理器平台。\n\n---\n\n## SOL 功能激活（sol activate）\n\n`sol activate` 命令用于激活**串行过LAN（Serial Over LAN, SOL）**功能，实现通过网络远程访问服务器控制台，适用于故障排查、系统安装等场景。\n\n| **权限级别** | administrator |\n|--------------|---------------|\n| **命令示例** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate`<br>`ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate usesolkeepalive` |\n\n> **输出示例**：<br>`[SOL Session operational. Use ~? for help]`<br>激活成功后，可通过 `~?` 查看帮助命令。\n\n---\n\n## SOL 功能关闭（sol deactivate）\n\n`sol deactivate` 命令用于关闭当前激活的 SOL 会话，释放网络资源。\n\n| **权限级别** | administrator |\n|--------------|---------------|\n| **命令示例** | `ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol deactivate` |\n\n> **说明**：建议在完成远程控制操作后及时关闭 SOL 会话，以提升系统安全性。\n\n---\n\n## Lenovo BMC 支持的 OEM RAW 命令\n\n以下为联想（Lenovo）BMC 固件支持的 OEM（专有）RAW 命令，适用于高级运维与定制化管理场景：\n\n- `raw 0x30 0x01`：获取系统健康状态（System Health Status）\n- `raw 0x30 0x02`：设置电源恢复策略（Power Restore Policy）\n- `raw 0x30 0x03`：查询当前启动设备（Current Boot Device）\n- `raw 0x30 0x04`：触发系统重启（Force Reboot）\n- `raw 0x30 0x05`：获取固件版本信息（Firmware Version）\n- `raw 0x30 0x06`：设置系统时间（Set System Time）\n- `raw 0x30 0x07`：获取传感器数据（Sensor Data Readings）\n\n> **使用说明**：OEM 命令需结合具体硬件平台（如联想问天 WenTian、天擎 ThinkSystem）及固件版本验证兼容性，建议通过官方文档或 `ipmitool raw` 命令测试确认。\n\n## SOL 激活（激活 SOL 功能）\n\n| 命令描述 | `sol activate` 命令用于激活 SOL（Serial Over LAN）功能 |\n| --- | --- |\n| 权限要求 | administrator |\n| 命令示例 | `lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol activate usesolkeepalive`<br>**输出示例**：`[SOL Session operational. Use ~? for help]` |\n\n## SOL 关闭（关闭 SOL 功能）\n\n| 命令描述 | `sol deactivate` 命令用于关闭 SOL 功能 |\n| --- | --- |\n| 权限要求 | administrator |\n| 命令示例 | `lenovo:~# ipmitool -H [BMC_IP] -U USERID -P PASSW0RD -I lanplus sol deactivate` |\n\n---\n\n## Lenovo BMC 支持的 OEM RAW 命令\n\n### 获取 SNMP Trap 信息（Get SNMP Trap Info）\n\n| 命令 | `netfn=0x30`, `cmd=0x02` |\n| --- | --- |\n\n#### 请求数据（Request Data）\n\n| 字节位置 | 数据字段 |\n| --- | --- |\n| 1 | 用户 ID（取值范围：01h 至 05h） |\n| 2 | 参数类型：<br>01h - 启用状态<br>02h - 严重级别<br>03h - 版本<br>04h - 模式<br>05h - 团体名（Community）<br>06h - 用户名<br>07h - 用户加密状态<br>08h - 密码<br>09h - 密码加密状态<br>0Ah - 目标 IP 地址<br>0Bh - 端口<br>0Ch - LAN 通道<br>0Dh - Enter ID |\n\n#### 响应数据（Response Data）\n\n| 参数 | 字节位置 | 数据字段 |\n| --- | --- | --- |\n| 01h（启用状态） | 1 | 完成码<br>2 | 00h - 禁用<br>\u2003\u2003\u2003\u200301h - 启用 |\n| 02h（严重级别） | 1 | 完成码<br>2 | 01h - 严重<br>\u2003\u2003\u2003\u200302h - 严重 + 警告<br>\u2003\u2003\u2003\u200303h - 所有 |\n| 03h（版本） | 1 | 完成码<br>2 | 01h - v1<br>\u2003\u2003\u2003\u200302h - v2c<br>\u2003\u2003\u2003\u200303h - v3 |\n| 04h（模式） | 1 | 完成码<br>2 | 模式值（具体含义依实现而定） |\n| 05h（团体名） | 1 | 完成码<br>2:17 | 团体名字符串（最大 16 字节） |\n| 06h（用户名） | 1 | 完成码<br>2:17 | 用户名字符串（最大 16 字节） |\n| 07h（用户加密状态） | 1 | 完成码<br>2 | 00h - 用户加密<br>\u2003\u2003\u2003\u200301h - 用户非加密 |\n| 08h（密码） | 1 | 完成码<br>2:17 | 密码字符串（最大 16 字节） |\n| 09h（密码加密状态） | 1 | 完成码<br>2 | 00h - 密码加密<br>\u2003\u2003\u2003\u200301h - 密码非加密 |\n| 0Ah（目标 IP 地址） | 1 | 完成码<br>2:33 | 目标 IP 地址（IPv4 格式，4 字节） |\n| 0Bh（端口） | 1 | 完成码<br>2:3 | 端口号（2 字节，大端序） |\n| 0Ch（LAN 通道） | 1 | 完成码<br>2 | LAN 通道编号（0-3） |\n| 0Dh（Enter ID） | 1 | 完成码<br>2:33 | Enter ID 字符串（最大 32 字节） |\n\n#### 命令示例\n\n```bash\n# ipmitool -H 10.109.107.160 -U USERID -P PASSW0RD raw 0x30 0x02 01h\n```\n\n> **说明**：  \n> - `10.109.107.160` 为 BMC IP 地址，需替换为实际值。  \n> - `USERID` 和 `PASSW0RD` 为管理员账户与密码。  \n> - `raw 0x30 0x02` 为 OEM RAW 命令的 NetFn 和 Cmd。  \n> - 参数 `01h` 表示查询“启用状态”，可根据需要替换为其他参数码。\n\n```markdown\n## 设置 SNMP Trap 信息（Set SNMP Trap Info）\n\n### 命令参数\n| 命令 | `netfn=0x30`, `cmd=0x03` |\n|------|--------------------------|\n\n### 请求数据（Request Data）\n| 字节 (Byte) | 数据字段 (Data Field) |\n|-------------|------------------------|\n| 1           | 用户 ID（取值范围：01h 至 05h） |\n| 2           | 参数标识（Parameter ID）：<br>• 01h：启用状态<br>• 02h：严重级别<br>• 03h：版本<br>• 04h：模式<br>• 05h：团体名（Community）<br>• 06h：用户名<br>• 07h：用户加密状态<br>• 08h：密码<br>• 09h：密码加密状态<br>• 0Ah：目标 IP 地址<br>• 0Bh：端口<br>• 0Ch：LAN 通道<br>• 0Dh：进入 ID |\n\n### 参数取值说明\n| 参数 ID | 取值说明 |\n|--------|----------|\n| 01h（启用状态） | • 00h：禁用<br>• 01h：启用 |\n| 02h（严重级别） | • 01h：严重（Critical）<br>• 02h：严重和警告（Critical & Warning）<br>• 03h：全部（All） |\n| 03h（版本） | • 01h：SNMPv1<br>• 02h：SNMPv2c<br>• 03h：SNMPv3 |\n\n### 响应数据（Response Data）\n| 字节 (Byte) | 数据字段 (Data Field) |\n|-------------|------------------------|\n| 1           | 完成代码（Completion Code） |\n\n### 命令示例（Command Example）\n```bash\n# ipmitool -H `10.109.107.160` -U USERID -P PASSW0RD\n```\n\n> **说明**：  \n> - `10.109.107.160` 为服务器 BMC 管理接口 IP 地址。  \n> - `USERID` 和 `PASSW0RD` 为 BMC 用户名与密码，需根据实际环境配置。  \n> - 本命令适用于联想问天（Lenovo WenTian）系列服务器，支持天擎（ThinkSystem）平台的 IPMI 2.0 接口操作。  \n> - 所有参数均需按指定格式输入，确保与硬件平台兼容（如至强（Xeon）处理器平台）。  \n> - 建议在使用前确认目标设备的 SNMP 配置策略及网络可达性。\n```', 'original_config': {'chinese_document': True, 'container_temp_dir': '/opt/***/temp', 'enable_ocr': True, 'extract_images': True, 'extract_tables': True, 'filename': 'test_short.pdf', 'input_dir': '/app/input', 'input_file': '/app/input/test_short.pdf', 'master_run_id': 'manual__2025-10-16T10:05:54.539140+00:00', 'output_target_dir': '/app/output/en', 'output_zh_dir': '/app/output/zh', 'pipeline_version': '4.0_fixed', 'preserve_structure': True, 'preserve_technical_terms': True, 'processing_stages': 4, 'processing_start_time': '2025-10-16T10:05:56.399198', 'qa_fail_action': 'halt', 'quality_level': 'high', 'quality_target': 95.0, 'stage_mode': 'full_with_translation', 'target_language': 'en', 'timestamp': 1760609154, 'translation_required': True, 'validation_enabled': True}, 'stage2_completed': True, 'transformation_metadata': {'final_quality_score': 97.14844017826533, 'basic_quality_score': 90.0, 'enhancement_used': True, 'enhancement_quality': 0.8, 'vllm_chunks_processed': 5, 'chinese_chars_preserved': 1963, 'technical_terms_preserved': 52, 'total_processing_time': 0.03533530235290527, 'completion_time': '2025-10-16T10:07:41.082600'}}
[2025-10-16T10:07:41.106+0000] {taskinstance.py:1138} INFO - Marking task as SUCCESS. dag_id=content_transformation, task_id=save_transformed_content, execution_date=20251016T100701, start_date=20251016T100740, end_date=20251016T100741
[2025-10-16T10:07:41.157+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 0
[2025-10-16T10:07:41.177+0000] {taskinstance.py:3280} INFO - 1 downstream tasks scheduled from follow-on schedule check
